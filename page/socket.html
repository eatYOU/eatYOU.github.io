<!DOCVAL>
<html> 
<head> 
<title>抓板打板</title> 
<meta charset="UTF-8">
<style> 

    body {
        font-family: "微软雅黑";
        color:#eee;
        font-size: 18px;
        background: black;
    }

    button {
        font-size: 0.8em;
    }

    input {
        font-size: 1em;
    }

    #outer-top {
        margin: 5px;
        text-align: center;
    }

    iframe {
        width: 90%;
        height: 40px;
        border: solid 2px #ccc;
    }

    table {
        margin-left: auto;
        margin-right: auto;
        border-collapse:collapse;
    }


    td {
        padding: 2px 5px;
        border: solid 1px #aaa;
    }

</style> 
    <script src="jquery-3.3.1.min.js"> </script>
</head> 
    <body> 
        <div id="outer-top">
            <iframe id="ifr" src="https://q.stock.sohu.com/hisHq?code=cn_000725&start=20200427&end=20210427"></iframe>
            <br/>
            <input id="code"></input>
            <button id="submit1" onclick='Socket.load()'>获取数据</button> 
            <input id="input"></input>
            <button id="submit2" onclick='Socket.parse()'>写入数据</button> 
            <button id="submit3" onclick='Socket.action(0.6, 0)'>6%抓涨停-失败</button> 
            <button id="submit4" onclick='Socket.action(0.6, 1)'>6%抓涨停-成功</button> 
            <button id="submit5" onclick='Socket.action(1.0, 1)'>10%打板</button> 
        </div>

        <div id="outer">
            <table>
                <tbody id="tbody">

                </tbody>
            </table>
        </div>
    </body> 
    <script type="text/javascript">

window.onload = function() {
    Socket.init();

}

const VAL = {
    DATE: 0,
    OPEN: 1,
    CLOSE: 2,
    DEEPTH: 3,
    DEGREE: 4,
    LOW: 5,
    HIGH: 6,
    VOLUME: 7,
    FUNDS: 8,
    SWAP: 9,
    SELL_OPEN: 10,
    SELL_CLOSE: 11,
    SELL_HIGH: 12,
    SELL_LOW: 13,
    BUY: 14,
};

const headStr = `
    <td>日期</td> 
    <td>开盘</td> 
    <td>收盘</td> 
    <td>涨跌额</td> 
    <td>涨跌幅</td> 
    <td>最低</td> 
    <td>最高</td> 
    <td>成交量</td> 
    <td>成交额</td> 
    <td>换手率</td> 
    <td>开盘卖出</td> 
    <td>收盘卖出</td> 
    <td>最高点卖出</td> 
    <td>最低点卖出</td>
    <td>买入价格</td>
    `;

let Socket = new __Socket();
function __Socket() {

    this.init = function() {
        this.inner = Elem.get('inner');
        this.outer = Elem.get('outer');
        this.input = Elem.get('input');
    }

    this.load = function() {
        let ifr = Elem.get('ifr');
        let code = Elem.get('code');
        this.input.innerHTML = '';
        ifr.src = 'https://q.stock.sohu.com/hisHq?code=cn_' + code.value + '&start=20200427&end=20880808';
    }

    this.show = function(data) {
        let tbody = Elem.get('tbody');
        let tr = Elem.creat('tr', tbody, 'tr');
        tbody.innerHTML= '';
        tr.innerHTML = headStr;
        tbody.appendChild(tr);
        for (let i in data) {
            tr = Elem.creat('tr', tbody, 'tr');
            for (let j in data[i]) {
                let td = Elem.creat('td', tr, 'td');
                td.innerHTML = data[i][j] ? data[i][j]:'';
            }
        }  
    }

    this.parse = function() {
        let data = eval(this.input.value)[0].hq;
        this.show(data);
    }

    this.action = function(multi, succeed) {
        let list = [];
        let rate = [0, 0, 0, 0, 0, 0, 0, 0, 0, '平均', 0, 0, 0, 0];
        let data = eval(this.input.value)[0].hq;
        for (let i=0; i<data.length; i++) {
            if (i > 0 && i < data.length - 1) {
                let nextDay = this.copy(data[i-1]);
                let theDay = this.copy(data[i]);
                let preDay = this.copy(data[i+1]);
                let nextDeg = eval(nextDay[VAL.DEGREE].replace('%',''));
                let theDeg = eval(theDay[VAL.DEGREE].replace('%',''));
                let preDeg = eval(preDay[VAL.DEGREE].replace('%',''));
                if ((succeed && theDeg > 9) || (!succeed && theDeg > 6 && theDeg < 9)) {
                // if ((succeed && theDeg < -9) || (!succeed && theDeg < -6 && theDeg > -9)) {
                    let nextOpen = nextDay[VAL.OPEN];
                    let theCost = theDay[VAL.CLOSE] - theDay[VAL.DEEPTH] * (1 - multi);
                    let r1 = (nextDay[VAL.OPEN]    - theCost)/nextOpen * 100;
                    let r2 = (nextDay[VAL.CLOSE]  - theCost)/nextOpen * 100;
                    let r3 = (nextDay[VAL.HIGH]  - theCost)/nextOpen * 100;
                    let r4 = (nextDay[VAL.LOW]  - theCost)/nextOpen * 100;
                    nextDay.push(this.to2f(r1));
                    nextDay.push(this.to2f(r2));
                    nextDay.push(this.to2f(r3));
                    nextDay.push(this.to2f(r4));
                    nextDay.push(theCost.toFixed(2));
                    rate[VAL.SELL_OPEN]    += r1;
                    rate[VAL.SELL_CLOSE]  += r2;
                    rate[VAL.SELL_HIGH]  += r3;
                    rate[VAL.SELL_LOW]  += r4;
                    list.push(nextDay);
                    list.push(theDay);
                }
            }
        }
        rate[VAL.SELL_OPEN]     = this.to2f(rate[VAL.SELL_OPEN]  / list.length * 2);
        rate[VAL.SELL_CLOSE]   = this.to2f(rate[VAL.SELL_CLOSE] / list.length * 2);
        rate[VAL.SELL_HIGH]   = this.to2f(rate[VAL.SELL_HIGH]  / list.length * 2);
        rate[VAL.SELL_LOW]   = this.to2f(rate[VAL.SELL_LOW]   / list.length * 2);
        list.push(rate);
        this.show(list);
    }

    this.to2f = function(value) {
        return value.toFixed(2) + '%';
    }

    this.copy = function(json) {
        return JSON.parse(JSON.stringify(json));
    }
}

 //元素
var  Elem = {};

//创建一个元素
Elem.creat = function(type, parent, className, id) {
    var e = document.createElement(type);
    if (parent)
        parent.appendChild(e);
    if (className)
        e.className = className;
    if (id != null)
        e.id = className + '_' + id;
    return e;
}

//获取当个元素
Elem.get = function (e) {
    if (typeof(e) === 'string')
        return Elem.get(document.getElementById(e));
    if (e &&  e.style)
        return e;
    return null;
}




    </script>
</html> 